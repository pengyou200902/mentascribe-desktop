# Codebase Structure

**Analysis Date:** 2026-02-19

## Directory Layout

```
mentascribe-desktop/
├── src/                          # React/TypeScript frontend (Vite)
│   ├── components/               # React components
│   │   ├── DictationBar.tsx      # Overlay widget (recording, waveform, status)
│   │   ├── Settings.tsx          # Settings modal
│   │   ├── History.tsx           # History view
│   │   ├── TranscriptionOverlay.tsx
│   │   ├── MenuBar.tsx
│   │   └── dashboard/            # Dashboard window pages
│   │       ├── Dashboard.tsx     # Main dashboard router
│   │       ├── HomePage.tsx      # Home/stats page
│   │       ├── HistoryPage.tsx   # Transcription history
│   │       ├── DictionaryPage.tsx # Custom replacements
│   │       ├── SettingsPage.tsx  # Full settings UI
│   │       └── Sidebar.tsx       # Dashboard navigation
│   ├── lib/                      # Utilities and stores
│   │   ├── store.ts             # Zustand settings store
│   │   ├── historyStore.ts      # Transcription history store
│   │   ├── dictionaryStore.ts   # Dictionary entries store
│   │   ├── statsStore.ts        # Statistics store
│   │   ├── tauri.ts             # Tauri API wrapper/types
│   │   └── theme.tsx            # Theme provider (dark/light)
│   ├── types/                    # TypeScript interfaces
│   │   └── index.ts             # Shared types (DailyStats, TranscriptionEntry, etc.)
│   ├── styles/                   # CSS
│   │   └── globals.css          # Tailwind + global styles
│   ├── icons/                    # SVG icons
│   ├── App.tsx                   # Root component (route dispatcher)
│   └── main.tsx                  # React entry point
│
├── src-tauri/                    # Rust backend (Tauri v2)
│   ├── src/
│   │   ├── lib.rs               # Main app setup, Tauri commands, window management
│   │   ├── main.rs              # Rust entry point (calls run() from lib.rs)
│   │   ├── audio/
│   │   │   ├── mod.rs           # Audio module exports
│   │   │   ├── capture.rs       # CPAL audio capture, levels, VAD hook
│   │   │   └── vad.rs           # Voice activity detection (stub/placeholder)
│   │   ├── transcription/
│   │   │   ├── mod.rs           # ModelInfo, CoremlStatus types
│   │   │   ├── whisper.rs       # Whisper model loading, caching, transcription
│   │   │   └── cloud.rs         # Cloud transcription providers (stub)
│   │   ├── settings/
│   │   │   └── mod.rs           # UserSettings struct, load/save to JSON
│   │   ├── hotkey/
│   │   │   └── mod.rs           # Global hotkey registration via global-hotkey
│   │   ├── injection/
│   │   │   └── mod.rs           # Text injection via enigo (keyboard/clipboard)
│   │   ├── text/
│   │   │   └── mod.rs           # Text post-processing (auto-capitalize)
│   │   ├── history/
│   │   │   └── mod.rs           # Transcription history persistence (JSON)
│   │   ├── dictionary/
│   │   │   └── mod.rs           # Custom word replacements (JSON)
│   │   ├── stats/
│   │   │   └── mod.rs           # Usage statistics tracking (JSON)
│   │   ├── api/
│   │   │   ├── mod.rs           # Auth types
│   │   │   └── client.rs        # API client (placeholder)
│   │   └── gen/                 # Auto-generated by Tauri
│   │       └── schemas/
│   ├── Cargo.toml                # Rust dependencies
│   ├── Cargo.lock
│   ├── build.rs                  # Tauri build script
│   ├── tauri.conf.json           # Tauri configuration (windows, security, plugins)
│   ├── capabilities/             # Tauri v2 security capabilities
│   ├── icons/                    # App icons (macOS, Windows, Linux)
│   └── target/                   # Build artifacts (excluded from repo)
│
├── .planning/
│   └── codebase/                 # Codebase analysis documents
│
├── dist/                         # Built frontend assets (dev/preview)
├── docs/                         # Documentation
├── index.html                    # HTML entry point
├── package.json                  # Frontend dependencies (Node.js)
├── tsconfig.json                 # TypeScript config (frontend)
├── tsconfig.node.json            # TypeScript config (Vite, backend tooling)
├── vite.config.ts                # Vite build config
├── tailwind.config.js            # Tailwind CSS config
├── postcss.config.js             # PostCSS config (Tailwind)
├── .eslintrc*                    # ESLint config
└── README.md
```

## Directory Purposes

**`src/`:**
- Purpose: React/TypeScript frontend application
- Contains: Components, stores, utilities, styles
- Key files: `App.tsx` (router), `main.tsx` (entry)

**`src/components/`:**
- Purpose: Reusable React components
- Contains: Dictation overlay, settings UI, dashboard pages
- Key files: `DictationBar.tsx` (main overlay), `dashboard/Dashboard.tsx` (window router)

**`src/components/dashboard/`:**
- Purpose: Dashboard window pages (multi-tab interface)
- Contains: HomePage (stats), HistoryPage, DictionaryPage, SettingsPage
- Key files: `Dashboard.tsx` (page router), `SettingsPage.tsx` (largest/most complex)

**`src/lib/`:**
- Purpose: Stores, utilities, configuration
- Contains: Zustand stores, Tauri integration, theme provider
- Key files: `store.ts` (settings), `tauri.ts` (Tauri API wrapper)

**`src/types/`:**
- Purpose: Shared TypeScript interfaces matching Rust backend
- Contains: Data structures for stats, history, dictionary, settings
- Key files: `index.ts` (all types)

**`src-tauri/src/`:**
- Purpose: Rust backend application logic
- Contains: System integration, transcription, data persistence
- Key files: `lib.rs` (app setup and commands), `main.rs` (entry)

**`src-tauri/src/audio/`:**
- Purpose: Audio capture and processing
- Contains: CPAL audio stream setup, level calculation, VAD hook
- Key files: `capture.rs` (main capture logic), `mod.rs` (exports)

**`src-tauri/src/transcription/`:**
- Purpose: Speech-to-text engine
- Contains: Whisper model loading/caching, transcription, model management
- Key files: `whisper.rs` (main implementation)

**`src-tauri/src/settings/`:**
- Purpose: Settings persistence
- Contains: UserSettings struct definition, JSON load/save
- Key files: `mod.rs` (all logic)

**`src-tauri/src/hotkey/`:**
- Purpose: Global keyboard shortcut handling
- Contains: global-hotkey registration, mode support (hold/toggle)
- Key files: `mod.rs` (all logic)

**`src-tauri/src/injection/`:**
- Purpose: Text output to active application
- Contains: enigo keyboard simulation, clipboard operations
- Key files: `mod.rs` (all logic)

**`src-tauri/src/history/`, `src-tauri/src/dictionary/`, `src-tauri/src/stats/`:**
- Purpose: Persistent storage of user data
- Contains: JSON file I/O, serde serialization
- Key files: Each has single `mod.rs` with full implementation

## Key File Locations

**Entry Points:**
- Frontend: `src/main.tsx` - React root initialization
- Frontend routing: `src/App.tsx` - Determines window type, sets up event listeners
- Rust: `src-tauri/src/main.rs` - Calls `run()` from lib.rs
- Rust setup: `src-tauri/src/lib.rs` - App initialization, command registration

**Configuration:**
- TypeScript: `tsconfig.json` - Frontend compiler options
- Vite: `vite.config.ts` - Frontend build config
- Tailwind: `tailwind.config.js` - CSS framework config
- Tauri: `src-tauri/tauri.conf.json` - Window config, plugins, security
- Rust: `src-tauri/Cargo.toml` - Dependencies

**Core Logic:**
- Recording pipeline: `src-tauri/src/lib.rs` (`start_recording`, `stop_recording`)
- Transcription: `src-tauri/src/transcription/whisper.rs` (model loading, transcription)
- Audio capture: `src-tauri/src/audio/capture.rs` (CPAL integration)
- Settings: `src-tauri/src/settings/mod.rs` (persistence layer)
- Text injection: `src-tauri/src/injection/mod.rs` (platform-specific output)

**Testing:**
- No test directory currently — tests would be added to `src-tauri/tests/` or component.test.ts

## Naming Conventions

**Files:**
- React components: PascalCase (e.g., `DictationBar.tsx`, `HistingsPage.tsx`)
- Utilities/stores: camelCase (e.g., `store.ts`, `tauri.ts`, `theme.tsx`)
- Rust modules: snake_case (e.g., `capture.rs`, `whisper.rs`)

**Directories:**
- Feature-based grouping: `audio/`, `transcription/`, `components/`, `dashboard/`
- Source roots: `src/` (frontend), `src-tauri/src/` (backend)

**Functions/Variables:**
- Rust: snake_case (`start_recording`, `get_models_dir`)
- TypeScript: camelCase (`startRecording`, `loadSettings`)
- React components: PascalCase (`DictationBar`, `HomePage`)
- Types: PascalCase interfaces (e.g., `UserSettings`, `AudioData`)

## Where to Add New Code

**New Feature (UI):**
- Primary code: `src/components/` (new component file)
- Store if needed: `src/lib/` (new Zustand store)
- Types: `src/types/index.ts` (add interface)
- Example: Add new dashboard page → create `src/components/dashboard/NewPage.tsx`, register in `Dashboard.tsx` router

**New Backend Feature (Tauri Command):**
- Command definition: `src-tauri/src/lib.rs` (add function with `#[tauri::command]`, register in invoke_handler)
- Implementation: Create module in `src-tauri/src/` (e.g., `src-tauri/src/newfeature/mod.rs`)
- Data types: `src-tauri/src/newfeature/mod.rs` and `src/types/index.ts` (matching types)
- Example: Add download manager → create `src-tauri/src/downloads/mod.rs`, add command in lib.rs

**New Store (Frontend State):**
- Implementation: `src/lib/newStore.ts` (create Zustand store)
- Export from: `src/lib/` (or create index.ts if multiple stores)
- Usage: Import in components, use via hook (e.g., `useNewStore()`)

**Utilities/Helpers:**
- Shared helpers: `src/lib/` (TypeScript) or `src-tauri/src/` as module (Rust)
- Example: Text formatting → `src-tauri/src/text/mod.rs`, hook from `stop_recording`

**Styles:**
- Global styles: `src/styles/globals.css` (Tailwind directives)
- Component styles: Inline Tailwind classes in JSX (tailwind-merge for conflicts)

## Special Directories

**`src-tauri/target/`:**
- Purpose: Cargo build artifacts
- Generated: Yes (by Cargo)
- Committed: No (in .gitignore)

**`dist/`:**
- Purpose: Built frontend assets from Vite
- Generated: Yes (by `npm run build`)
- Committed: No (in .gitignore)

**`src-tauri/gen/`:**
- Purpose: Auto-generated Tauri files (schemas, types)
- Generated: Yes (by Tauri CLI)
- Committed: No (in .gitignore)

**`.planning/codebase/`:**
- Purpose: Codebase analysis documents (ARCHITECTURE.md, STRUCTURE.md, etc.)
- Generated: No (manually created)
- Committed: Yes (reference documents)

**`node_modules/`:**
- Purpose: npm dependencies
- Generated: Yes (by npm install)
- Committed: No (in .gitignore)

---

*Structure analysis: 2026-02-19*
